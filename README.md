# Mastered test

Тест работы нескольких обработчиков для синхронизации которых использутся система zookeeper.


## Установка

### Сборка

* Собираем mastered_test


`./rebar get-deps`
`./rebar compile`

### Настройка конфигурации 

см. rel/files/app.config

* Устанавливаем количество обработчиков number_of_workers
* Задаем список нод в кластере cnodes


### Генерации тестового сервера
`./rebar generate`

### Создание нескольких серверов
* Копируем rel/stest в TestDir/statet1,...,TestDir/statetN
* Меняем имя сервера в TestDir/statetN/etc/vm.args
### Настройка zookeeper

* Устанавливаем

* Создаем пути для проведения голосований обработчиками (например, через zkCli.sh)

`/mastered_test/election/workerN`, где `N=0,,Число обработчиков-1`.

## Использование

Для удобства управления выделен фасад mtf.

* Запуск:
 TestDir/statetN/bin/mtest start (лог пишется в TestDir/statetN/log/erlang.log)  или TestDir/statetN/bin/mtest console

* Запрос к обработчику

  `mtf:ask(N)`, где `N` - номер обработчика.

  Если обрабочик на ноде, с которой происходит запрос, имеет наивысший приоритет
  из всех _запущенных_ нод (наименьший номер Order), то он отвечает непосредственно.

  В противном случае он сообщеает _адрес_ ноды, у которой нужно спросить данные
  (при этом та нода может произвести перенаправление дальше по цепочке увеличения приоритета)

